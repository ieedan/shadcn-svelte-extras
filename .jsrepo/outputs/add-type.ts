import { Output } from 'jsrepo/outputs';
import path from 'node:path';
import fs from 'node:fs';

export default function (): Output {
	return {
		output: async (buildResult, { cwd }) => {
			const filePath = path.join(cwd, 'src/lib/registry-items.ts');

			const itemNames = buildResult.items
				.filter((item) => item.add === 'when-added')
				.map((item) => item.name);

			const fileContent = `/**
* This file is automatically generated by jsrepo.
* Do not edit this file manually.
*/

export const REGISTRY_ITEMS = [
${itemNames.map((item) => `\t'${item}'`).join(',\n')}
] as const;

export type RegistryItem = (typeof REGISTRY_ITEMS)[number];
`;

			fs.writeFileSync(filePath, fileContent);
		},
		clean: async () => {}
	};
}
